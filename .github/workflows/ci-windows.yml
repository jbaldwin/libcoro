name: ci-windows

on: [pull_request, workflow_dispatch]

jobs:
    ci-windows-2022:
        name: windows-2022
        runs-on: windows-latest
        strategy:
            matrix:
                libcoro_build_shared_libs: [OFF, ON]
        env:
            VERBOSE: 1
        steps:
            -   name: Checkout
                uses: actions/checkout@v4
                with:
                    submodules: recursive
            -   name: Build
                run: |
                    mkdir Release
                    cd Release
                    cmake .. -DCMAKE_INSTALL_PREFIX=install -DLIBCORO_BUILD_SHARED_LIBS=${{ matrix.libcoro_build_shared_libs }}
                    cmake --build . --config Release
            -   name: Test
                run: |
                    cd Release
                    ctest --build-config Release -VV
            -   name: Install
                run: |
                    cmake --build Release --config Release --target install
